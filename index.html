<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Capture</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            background-color: black;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        #capture-button {
            width: 100px;
            height: 100px;
            background-color: red;
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }
        #overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 48px;
        }
    </style>
</head>
<body>
    <button id="capture-button"></button>
    <div id="overlay">
        <span id="timer"></span>
    </div>
    <video id="video" autoplay playsinline style="display:none;"></video>

    <!-- Firebase Configuration -->
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-storage.js"></script>
    <script>
        // Your Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyCIY6aAg-JCpKnm6X51tEktW6v_fLWfU10",
            authDomain: "satsuei-c1b33.firebaseapp.com",
            projectId: "satsuei-c1b33",
            storageBucket: "satsuei-c1b33.appspot.com",
            messagingSenderId: "948629477465",
            appId: "1:948629477465:web:84c23181285afd9d86f948",
            measurementId: "G-KS0947K55F"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        var storage = firebase.storage();
    </script>

    <!-- Camera and Capture Script -->
    <script>
        const captureButton = document.getElementById('capture-button');
        const overlay = document.getElementById('overlay');
        const video = document.getElementById('video');
        const timerElement = document.getElementById('timer');
        let mediaStream = null;
        let captureInterval = null;
        let timeInterval = null;

        captureButton.addEventListener('click', async () => {
            captureButton.style.display = 'none';
            overlay.style.display = 'flex';
            startClock();

            try {
                mediaStream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = mediaStream;

                captureInterval = setInterval(captureAndUpload, 10000);
            } catch (err) {
                console.error('Error accessing camera: ', err);
                captureButton.style.display = 'block';
                overlay.style.display = 'none';
            }
        });

        overlay.addEventListener('click', () => {
            clearInterval(captureInterval);
            clearInterval(timeInterval);
            overlay.style.display = 'none';
            captureButton.style.display = 'block';

            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;
            }
        });

        function startClock() {
            timeInterval = setInterval(() => {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                timerElement.textContent = `${hours}:${minutes}:${seconds}`;
            }, 1000);
        }

        async function captureAndUpload() {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            canvas.toBlob(async (blob) => {
                const storageRef = storage.ref();
                const fileRef = storageRef.child(`images/${new Date().toISOString()}.jpg`);
                try {
                    await fileRef.put(blob);
                    console.log('Uploaded a blob or file!');
                } catch (err) {
                    console.error('Error uploading to Firebase: ', err);
                }
            }, 'image/jpeg');
        }
    </script>
</body>
</html>
